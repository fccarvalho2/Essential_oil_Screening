function qmeanLocalColour(a,y){return.4<a?null==y?"rgb("+Math.round(1/.6*(1-a)*255)+",80,"+Math.round(1/.6*(a-.4)*255)+")":"rgba("+Math.round(1/.6*(1-a)*255)+",80,"+Math.round(1/.6*(a-.4)*255)+","+y+")":null==y?"rgb(255,80,0)":"rgba(255,80,0,"+y+")"}
function drawQMEANLocal(a,y,l,D,w,t,B){var g=["lq-chart"+(l?"-"+l:"")];if((t||!(0<$("#"+g[0]+" svg").length))&&a){for(t=0;t<a.length;t++){var d="lq-chart"+(l?"-"+l:"");0==t&&(0==$("#"+d).length?$("body").append("<div"+(l?' rel="'+l+'"':"")+' id="'+d+'" style="display:none"></div>'):$("#"+d).empty(),$("#"+d+"-thumb").empty());if(1==a.length)break;d+="-"+a[t].chain;g.push(d);0==$("#"+d).length?$("body").append("<div"+(l?' rel="'+l+'"':"")+' id="'+d+'" style="display:none"></div>'):$("#"+d).empty();
0==$('a[href="#'+d+'"]').length&&$("body").append('<a href="#'+d+'" rel="lq-'+(l?l:"")+'" class="fancybox"/>')}t=!0;for(d=0;d<g.length;d++){var n=void 0,e=void 0,p=void 0,q=0,u=0,v=0,r=!1;t?($("#"+g[d]+"-thumb").attr("title","Click to enlarge"),n=$("#"+g[d]+"-thumb").closest(":visible").width(),e=$("#"+g[d]+"-thumb").closest(":visible").height(),0==e&&(e=Math.min(200,.5*n)),200<=e?(p=12,q=45,u=30,v=40,r=!0):(w&&(q=30,u=16),p=Math.max(15,e/10))):(p=20,q=45,u=30,v=40,n=.7*$(window).width()+q,e=.7*$(window).height()+
v+u);for(var x=Raphael(g[d]+(t?"-thumb":""),n,e),C=99999,c=0,m=0,z=0,f=.3,b=0;b<a.length;b++)if(!(0<d&&d-1!=b))for(var h=0;h<a[b].scores.length;h++)a[b].scores[h][1]&&(f=Math.min(f,a[b].scores[h][1]),C=Math.min(a[b].scores[h][0],C),c=Math.max(a[b].scores[h][0],c),z+=1,m+=a[b].scores[h][1]);null==y&&(y=m/z,$("#avgLocalQMEAN").html(y.toFixed(2)));m=e-v-u;z=(n-q)/(c-C);x.rect(0,0,n,e).attr({fill:"#FFF",stroke:"#FFF"});if(t&&!r)x.rect(q,u,n-q,m).attr({stroke:"#DDD"}),w&&(x.text(n/2,8,"Local Quality Estimate").attr({"text-anchor":"middle",
fill:"#444","font-size":Math.max(8,e/24)}),x.text(6,e/2+u/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,e/26)}).rotate(270,6,e/2+u/2),x.text(18,e/2+u/2,"Similarity to Target").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,e/26)}).rotate(270,18,e/2+u/2));else{x.rect(q,u,n-q,m).attr({stroke:"#DDD"});r=14;b="Local Quality Estimate";B&&(b+=" (QMEANBrane) ");b=0==d?1==a.length?b+(" - Chain "+a[0].chain):b+" - All Chains":b+(" - Chain "+a[d-1].chain);
x.text(n/2,10,b).attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,e/26)});t?(x.text(6,e/2,"Predicted Local").attr({"text-anchor":"middle",fill:"#666","font-size":p}).rotate(270,6,e/2),x.text(18,e/2,"Similarity to Target").attr({"text-anchor":"middle",fill:"#666","font-size":p}).rotate(270,18,e/2),r=p):x.text(10,e/2,"Predicted Local Similarity to Target").attr({dy:10,"text-anchor":"middle",fill:"#666","font-size":p}).rotate(270,10,e/2);x.text(q+(n-q)/2,e-8,"Residue Number").attr({"text-anchor":"middle",
fill:"#666","font-size":p});for(b=1;b>=f;b-=.1)x.path("M"+q+" "+(m/(1-f)*(1-b)+u)+"L"+(q-5)+" "+(m/(1-f)*(1-b)+u)).attr({stroke:"#CCC","stroke-width":1}),x.text(q-12,m/(1-f)*(1-b)+u,b.toFixed(1)).attr({fill:"#444","font-size":r});p=Math.floor((c-C)/8);p-=p%10;p=Math.max(10,p);var k=null;for(b=C;b<c;b++)0==b%p&&(h=q+(b-C)/(c-C)*(n-q),k&&k>h||(k=x.text(h,e-v+12,b).attr({fill:"#444","font-size":r}),k=h+k.getBBox().width))}n="#999999 #E69F00 #56B4E9 #009E73 #F0E442 #0072B2 #D55E00 #CC79A7".split(" ");
e=0;for(v={$jscomp$loop$prop$j$2$5:0};v.$jscomp$loop$prop$j$2$5<a.length;v={$jscomp$loop$prop$j$2$5:v.$jscomp$loop$prop$j$2$5},v.$jscomp$loop$prop$j$2$5++){t&&D&&($(".alignTbl").each(function(A){return function(){if(null!=$(this).data("templateData")){var F="chain";"target-template"!=$(this).data().templateData.type&&(F="keyseqchain");$(this).find('tr[struc_id="'+D+'"]['+F+'="'+a[A.$jscomp$loop$prop$j$2$5].chain+'"] span').each(function(G,H){for(var I=parseInt(H.getAttribute("s")),E=0;E<a[A.$jscomp$loop$prop$j$2$5].scores.length;E++)if(I==
a[A.$jscomp$loop$prop$j$2$5].scores[E][0]){a[A.$jscomp$loop$prop$j$2$5].scores[E][1]&&H.setAttribute("q",a[A.$jscomp$loop$prop$j$2$5].scores[E][1]);break}})}}}(v)),$.cookie("colourScheme")&&"qmean_local"==$.cookie("colourScheme")&&$(".alignTbl:first").alignment("colourAllAlignments",{col:"qmean_local"}));c=null;if(0==d||d-1==v.$jscomp$loop$prop$j$2$5){b=m/(1-Math.min(f,y))*(1-y)+u;for(p=0;p<a[v.$jscomp$loop$prop$j$2$5].scores.length-1;p++)r=a[v.$jscomp$loop$prop$j$2$5].scores[p][1],null!=r&&(h=q+
z*(a[v.$jscomp$loop$prop$j$2$5].scores[p][0]-C),k=b-m/(1-f)*(r-y),0==d&&1<a.length?(k=Math.min(k,m+u),c=null==c?"M"+h+" "+k:c+("L"+h+" "+k),c+="L"+(h+z)+" "+k):(r>y?bar=x.rect(h,k,z,m/(1-f)*(r-y)):(k=m/(1-f)*(y-r),k=Math.min(k,m-b+u),bar=x.rect(h,b,z,k)),r=qmeanLocalColour(r),bar.attr({stroke:r,"stroke-width":.7,fill:r,"fill-opacity":.4})));0==d&&1<a.length&&(c=x.path(c),c.attr({stroke:n[e],"stroke-width":t?1:1.5}),t||$("#lq-chart"+(l?"-"+l:"")).append((0==v.$jscomp$loop$prop$j$2$5?"<br>Key: ":"")+
' <span style="margin-right:4px; color:'+n[e]+'">Chain '+a[v.$jscomp$loop$prop$j$2$5].chain+";</span>"))}e=++e%n.length}t&&(t=!1,d--)}}}
function drawQMEANGlobal(a,y,l,D,w){var t=$("#qn-chart"+(l?"-"+l:"")+"-thumb,#qn-chart"+(l?"-"+l:""));if(a&&(l="qmeanGlobalTbl"+(l?l:""),w||!(0<$("#"+l+" tr").length))){t.empty();$("#"+l+" tr").remove();a.QMEAN4&&(a.qmean4_norm_score=a.qmean4_norm,delete a.qmean4_norm,a.qmean4_z_score=a.QMEAN4,delete a.QMEAN4,a.cbeta_z_score=a.cbeta,delete a.cbeta,a.interaction_z_score=a.all_atom,delete a.all_atom,a.packing_z_score=a.solvation,delete a.solvation,a.torsion_z_score=a.torsion,delete a.torsion);a.qmean4&&
(a.qmean4_norm_score=parseFloat(a.qmean4.norm),a.qmean4_z_score=parseFloat(a.qmean4.zscore),delete a.qmean4,a.cbeta_z_score=parseFloat(a.cbeta.zscore),delete a.cbeta,a.interaction_z_score=parseFloat(a.all_atom.zscore),delete a.all_atom,a.packing_z_score=parseFloat(a.solvation.zscore),delete a.solvation,a.torsion_z_score=parseFloat(a.torsion.zscore),delete a.torsion,delete a.acc_agreement,delete a.ss_agreement,delete a.qmean6);w=[["qmean4_z_score","QMEAN"],["cbeta_z_score","C\u03b2"],["interaction_z_score",
"All Atom"],["packing_z_score","solvation"],["torsion_z_score","torsion"]];for(var B="",g=0;g<w.length;g++)null!=a[w[g][0]]&&(B+='<tr><td width="1">'+w[g][1]+'</td><td width="100%" style="padding:0px 2px 0px 2px;"><div id="'+l+"_"+w[g][0]+'">&nbsp;</div></td><td width="1" nowrap="nowrap" style="text-align:right">'+a[w[g][0]].toFixed(2)+"</td></tr>");$("#"+l).append(B);B=$("#"+l+"_"+w[0][0]).innerWidth();var d=$("#"+l+"_"+w[0][0]).parent().innerHeight();if(1>B||1>d)B=290,d=20;for(g=0;g<w.length;g++)$("#"+
l+"_"+w[g][0]).html("");for(var n=B/8,e=0;e<w.length;e++)if(null!=a[w[e][0]]){var p=Raphael(l+"_"+w[e][0],B,d);p.rect(0,0,B,d).attr({fill:"0-rgb(245,61,61)-#fff:75-rgb(77,77,255)"});var q=d/4;for(g=1;8>g;g++)p.path("M"+n*g+" 0L"+n*g+" "+q).attr({stroke:"#555"}),p.path("M"+n*g+" "+(d-q)+"L"+n*g+" "+d).attr({stroke:"#555"});a&&(g=a[w[e][0]],g=Math.min(g,1.95),g=Math.max(g,-5.95),p.path("M"+(n*g+6*n)+" 0L"+(n*g+6*n)+" "+d).attr({stroke:"#222","stroke-width":3}))}var u=a.qmean4_norm_score,v=Math.min(600,
y),r=!0;t.each(function(x,C){var c=0,m=0,z=0;if(r){$(this).attr("title","Click to enlarge");var f=$(this).closest(":visible").width();if(340<f){var b=12;c=45;m=30;z=40;f-=c;var h=400/620*f-z+m}else h=.5*f,D&&(c=15,m=30),b=Math.max(15,h/10)}else b=20,c=45,m=30,z=40,f=617+c,h=398+z+m;var k=Raphael($(this).attr("id"),f,h),A=h-z-m,F=v/600*(f-c)+c,G=A-u/1.5*A+m;k.rect(0,0,f,h).attr({fill:"#FFF",stroke:"#FFF"});"undefined"===typeof localQMEANNormImage?k.image("/static/images/qmean_norm.png",c,m,f-c,A):
k.image(localQMEANNormImage,c,m,f-c,A);k.rect(c,m,f-c,A).attr({stroke:"#DDD"});k.text(F,G,String.fromCharCode(9733)).attr({"text-anchor":"middle",fill:"#F44","font-size":b});if(r)D&&(k.text((f+c)/2,8,"Comparison with Non-redundant").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,f/32)}),k.text((f+c)/2,22,"Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,f/32)}),k.text(6,h/2+m/2,"Normalized QMEAN4").attr({"text-anchor":"middle",fill:"#666","font-size":Math.max(8,
f/32)}).rotate(270,6,h/2+m/2)),k.rect(c+1,h-Math.max(16,f/16),f-c-2,Math.max(16,f/16)).attr({fill:"#FFF","stroke-width":0}),k.text(f/2,h-8,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#444","font-size":Math.max(8,f/32)});else{k.text((f+c)/2,10,"Comparison with Non-redundant Set of PDB Structures").attr({"text-anchor":"middle",fill:"#444","font-size":b});k.text(10,h/2,"Normalized QMEAN4 Score").attr({"text-anchor":"middle",fill:"#666","font-size":b}).rotate(270,10,h/2);k.text(c+(f-
c)/2,h-12,"Protein Size (Residues)").attr({"text-anchor":"middle",fill:"#666","font-size":b});for(b=100;600>b;b+=100)k.text(c+b*(f-c)/600,h-z+8,b).attr({fill:"#444","font-size":14});for(b=1.5;0<=b;b-=.5)k.text(c-12,b/1.5*A+m,(1.5-b).toFixed(1)).attr({fill:"#444","font-size":14})}r=!1})}};